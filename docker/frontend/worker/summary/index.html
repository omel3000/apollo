<!doctype html>
<html lang="pl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Podsumowania Miesiƒôczne</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
  <link rel="stylesheet" href="styles.css">
  <script src="/auth.js"></script>
 </head>
 <body>
  <!-- Modal niepowodzenia autoryzacji -->
  <div id="authFailModal" class="modal" style="display: none;">
   <div class="modal-content">
    <div class="modal-header">
     <h2>Panel Apollo</h2>
    </div>
    <div class="modal-body">
     <p>Nie jeste≈õ zalogowany. Zaloguj siƒô, aby uzyskaƒá dostƒôp.</p>
    </div>
    <div class="modal-footer">
     <button class="btn-primary" id="authFailOkBtn">OK</button>
    </div>
   </div>
  </div>

  <div class="container"><!-- Header -->
   <header class="header">
    <div class="header-title" id="pageTitle">
     Podsumowania miesiƒôczne
    </div>
    <div class="header-icons"><button class="icon-button" id="accountBtn" aria-label="Ustawienia konta">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="#4a5568"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" />
      </svg></button> <button class="icon-button" id="logoutBtn" aria-label="Wyloguj">
      <svg width="24" height="24" viewbox="0 0 24 24" fill="#4a5568"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z" />
      </svg></button>
    </div>
   </header><!-- Sidebar -->
   <aside class="sidebar">
    <nav class="menu">
     <div class="menu-item" id="menuHome"><span class="menu-icon">üè†</span> <a href="/worker/" class="menu-link" style="color: inherit; text-decoration: none;"><span id="menuHomeText">Strona g≈Ç√≥wna</span></a>
     </div>
     <div class="menu-item" id="menuTime"><span class="menu-icon">‚è∞</span> <a href="/worker/reports/" class="menu-link" style="color: inherit; text-decoration: none;"><span id="menuTimeText">Rejestracja czasu pracy</span></a>
     </div>
     <div class="menu-item active" id="menuSummary"><span class="menu-icon">üìä</span> <span id="menuSummaryText">Podsumowania</span>
     </div>
    </nav>
   </aside><!-- Main Content -->
   <main class="main-content"><!-- Month Navigation -->
    <div class="content-panel">
     <div class="summary-header">
      <div class="month-display">
       <div class="month-name" id="summaryMonthName">
        Stycze≈Ñ 2024
       </div><!-- Month Navigation -->
       <div class="date-navigation"><button class="nav-button" id="prevMonthBtn" aria-label="Poprzedni miesiƒÖc"> ‚Üê </button> <button class="current-month-button" id="currentMonthBtn">Bie≈ºƒÖcy miesiƒÖc</button> <button class="nav-button" id="nextMonthBtn" aria-label="Nastƒôpny miesiƒÖc"> ‚Üí </button>
       </div>
      </div>
     </div>
    </div><!-- Summary Stats and Chart -->
    <div class="summary-content"><!-- Left Panel - Chart and Legend -->
     <div class="chart-panel">
      <div class="content-panel">
       <div class="total-hours"><span class="total-label" id="totalHoursLabel">≈ÅƒÖczna ilo≈õƒá godzin:</span> <span class="total-value" id="totalHours">0</span>
       </div><!-- Chart Container -->
       <div class="chart-container">
        <canvas id="projectChart" width="300" height="300"></canvas>
       </div><!-- Legend -->
       <div class="chart-legend" id="chartLegend"><!-- Legend items will be generated here -->
       </div>
      </div>
     </div><!-- Right Panel - Daily Breakdown -->
     <div class="daily-panel">
      <div class="content-panel">
       <div class="panel-header" id="dailyBreakdownTitle">
        Szczeg√≥≈Çowe rozpisanie
       </div>
       <div id="dailyBreakdown"><!-- Daily breakdown will be generated here -->
       </div>
      </div>
     </div>
    </div>
   </main>
  </div>
  <script src="script.js"></script>
  <script>
    // Walidacja autentykacji i roli przy za≈Çadowaniu strony
    (async function() {
      const token = localStorage.getItem('token');
      if (!token) {
        showAuthFailModal();
        return;
      }
      
      try {
        const response = await fetch('/users/me', {
          headers: { 'Authorization': `Bearer ${token}` }
        });
        
        if (!response.ok) {
          localStorage.removeItem('token');
          showAuthFailModal();
          return;
        }
        
        const user = await response.json();
        if (user.role !== 'worker') {
          showAuthFailModal();
          return;
        }
      } catch (error) {
        console.error('B≈ÇƒÖd weryfikacji:', error);
        localStorage.removeItem('token');
        showAuthFailModal();
      }
    })();

    function showAuthFailModal() {
      const modal = document.getElementById('authFailModal');
      modal.style.display = 'flex';
      
      document.getElementById('authFailOkBtn').onclick = function() {
        window.location.href = '/index.html';
      };
    }
  </script>
 </body>
</html>